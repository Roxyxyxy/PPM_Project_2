{% extends 'store/main.html' %} {% block content %}
<div class="container mt-4">
  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'store' %}">Home</a></li>
      <li class="breadcrumb-item">
        <a href="{% url 'management:dashboard' %}">Management</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'management:order_list' %}">Orders</a>
      </li>
      <li class="breadcrumb-item active">Order #{{ order.id }}</li>
    </ol>
  </nav>

  <!-- Header -->
  <div class="bg-primary text-white p-3 mb-4 rounded">
    <h2 class="m-0">Order #{{ order.id }} Details</h2>
  </div>

  <!-- Order Info -->
  <div class="row mb-4">
    <!-- Customer Information -->
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="m-0">Customer Information</h5>
        </div>
        <div class="card-body">
          <p>
            <strong>Name:</strong> {{ order.customer.name|default:"Guest" }}
          </p>
          <p>
            <strong>Email:</strong> {% if order.customer.email %}{{
            order.customer.email }}{% else %}Not provided{% endif %}
          </p>
          <p>
            <strong>Username:</strong> {% if order.customer.user.username %}{{
            order.customer.user.username }}{% else %}Not registered{% endif %}
          </p>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-info text-white">
          <h5 class="m-0">Order Summary</h5>
        </div>
        <div class="card-body">
          <p><strong>Order ID:</strong> {{ order.id }}</p>
          <p>
            <strong>Date:</strong> {{ order.date_ordered|date:"d-m-Y H:i" }}
          </p>
          <p>
            <strong>Status:</strong>
            {% if order.complete %}
            <span class="badge bg-success">Completed</span>
            {% else %}
            <span class="badge bg-warning text-dark">Pending</span>
            {% endif %}
          </p>
          <p>
            <strong>Total:</strong> €{{ order.get_cart_total|floatformat:2 }}
          </p>
          <p><strong>Items:</strong> {{ order.get_cart_items }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Shipping Information (if available) -->
  {% if order.shippingaddress_set.all %}
  <div class="card mb-4">
    <div class="card-header bg-info text-white">
      <h5 class="m-0">Shipping Information</h5>
    </div>
    <div class="card-body">
      {% for address in order.shippingaddress_set.all %}
      <p><strong>Address:</strong> {{ address.address }}</p>
      <p><strong>City:</strong> {{ address.city }}</p>
      <p><strong>State:</strong> {{ address.state }}</p>
      <p><strong>Zipcode:</strong> {{ address.zipcode }}</p>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Order Items -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white">
      <h5 class="m-0">Order Items</h5>
    </div>
    <div class="card-body p-0">
      <table class="table mb-0">
        <thead class="bg-light">
          <tr>
            <th>Product</th>
            <th>Image</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for item in order_items %}
          <tr>
            <td>{{ item.product.name }}</td>
            <td>
              <img
                src="{{ item.product.imageURL }}"
                width="50"
                height="50"
                class="img-thumbnail"
                alt="{{ item.product.name }}"
              />
            </td>
            <td>{{ item.quantity }}</td>
            <td>€{{ item.product.price|floatformat:2 }}</td>
            <td>€{{ item.get_total|floatformat:2 }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center">No items in this order.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Actions -->
  <div class="mb-4">
    <a href="{% url 'management:order_list' %}" class="btn btn-primary">
      Back to Orders
    </a>
    {% if not order.complete %}
    <form
      method="post"
      action="{% url 'management:mark_order_complete' order.id %}"
      class="d-inline"
    >
      {% csrf_token %}
      <button type="submit" class="btn btn-success">Mark as Complete</button>
    </form>
    {% endif %}
  </div>
</div>
{% endblock %}
