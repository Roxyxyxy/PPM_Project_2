{% extends 'store/main.html' %} {% load static %} {% block content %}

<p class="homecart">
  <a href="{% url 'store' %}">Home</a> &gt;
  <a href="{% url 'my_orders' %}">I miei ordini</a>
</p>

<h1 class="text-info">I miei ordini</h1>

<!-- Messaggio dopo checkout completato -->
{% if just_completed %}
<div class="alert alert-success">
  Grazie per il tuo acquisto! Il tuo ordine è stato completato con successo.
</div>
{% endif %}

<!-- Lista ordini -->
{% if orders %}
<div class="row">
  <div class="col-12">
    {% for order in orders %}
    <div class="card mb-4">
      <div
        class="card-header bg-light d-flex justify-content-between align-items-center"
      >
        <h5 class="m-0">Ordine #{{ order.id }}</h5>
        <div>
          <span class="badge bg-success">Completato</span>
          <span class="ms-2">{{ order.date_ordered|date:"d-m-Y H:i" }}</span>
        </div>
      </div>

      <div class="card-body">
        <h6>Totale: €{{ order.get_cart_total|floatformat:2 }}</h6>
        <p>Articoli: {{ order.get_cart_items }}</p>

        <!-- Prodotti -->
        <div class="mt-3">
          <h6>Prodotti acquistati:</h6>
          <ul class="list-group">
            {% for item in order.orderitem_set.all %}
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              {{ item.product.name }}
              <span
                >{{ item.quantity }} x €{{ item.product.price|floatformat:2
                }}</span
              >
            </li>
            {% endfor %}
          </ul>
        </div>

        <!-- Indirizzo di spedizione con formattazione corretta -->
        <div class="mt-3">
          <h6>Indirizzo di spedizione:</h6>
          {% if order.shippingaddress_set.all %}
            {% for address in order.shippingaddress_set.all %}
              <p class="mb-1">{{ address.name }}</p>
              <p class="mb-1">{{ address.address }}</p>
              <p class="mb-1">
                {{ address.city }}, {{ address.state }} {{ address.zipcode }}
              </p>
              {% if not forloop.last %}
                <hr />
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% else %}
<div class="alert alert-info">
  Non hai ancora effettuato nessun ordine.
  <a href="{% url 'store' %}">Vai allo shop</a>
</div>
{% endif %} {% endblock content %}
